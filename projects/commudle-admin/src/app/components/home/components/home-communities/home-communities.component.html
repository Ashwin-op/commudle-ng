<nb-card class="home-communities card-p16">
  <nb-card-header>
    Communities
    <p class="sub-header">
      Join multiple tribes of Techies
    </p>
  </nb-card-header>
  <nb-card-body class="home-communities-list">
    <nb-list *ngIf="communities.length === 0">
      <nb-list-item *ngFor="let _ of [].constructor(7)">
        <app-skeleton-text [rows]="2"></app-skeleton-text>
      </nb-list-item>
    </nb-list>
    <nb-list *ngIf="communities.length > 0">
      <nb-list-item *ngFor="let community of communities; let i = index">
        <div [routerLink]="['/communities', community.slug]" class="home-community d-flex align-items-center clickable">
          <div class="home-community-image d-flex align-items-center">
            <img alt="{{community.name}}" src="{{community.logo_image.i64}}">
          </div>
          <div class="home-community-details">
            <div class="home-community-name">
              {{community.name | truncatetext:20}}
            </div>
            <div class="home-community-member-count">
              {{community.member_count.toString() + ' Members'}}
            </div>
          </div>
        </div>
        <button (click)="joinCommunity(community)" *ngIf="community.id" [nbPopover]="joinCommunityPopover"
                [ngClass]="communityStatus[i] ? 'active' : ''" class="home-communities-join" nbButton shape="round">
          {{communityStatus[i] ? 'Joined' : 'Join'}}
        </button>
      </nb-list-item>
    </nb-list>
    <div *ngIf="communities.length > 0" [routerLink]="['/communities']"
         class="home-communities-all text-center clickable">
      <a>Find more</a>
    </div>
  </nb-card-body>
</nb-card>

<ng-template #joinCommunityPopover>
  <div class="card-p16 d-flex flex-column align-items-center">
    <p>Do you want to know more about <em>{{selectedCommunity.name}}</em> before joining?</p>
    <div class="d-flex justify-content-space-between w-100">
      <button [routerLink]="['communities', selectedCommunity.slug]" ghost nbButton size="small">Know More</button>
      <app-membership-toggle (joinedCommunity)="changeCommunityStatus($event)"
                             [community]="selectedCommunity"></app-membership-toggle>
    </div>
  </div>
</ng-template>
